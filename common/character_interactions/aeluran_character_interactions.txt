## Can be used to reboot matchmaking after pausing it
request_matchmaking_interaction = {
	category = interaction_category_friendly
	interface_priority = 60
	icon = icon_aeluran_sister

	desc = request_matchmaking_desc
	use_diplomatic_range = no
	common_interaction = yes
	
	is_shown = {
		# NOT = { scope:recipient = scope:actor }

		OR = {
			AND = {
				scope:recipient = scope:actor
				scope:actor = {
					has_character_flag = refused_matchmaking
				}
			}
			AND = {
				scope:recipient = {
					is_close_or_extended_family_of = scope:actor
					is_married = no
					is_betrothed = no
					is_adult = yes
				}
				scope:actor = {
					is_liege_or_above_of = scope:recipient
					exists = diarch
					diarch = { # Diarch has to be landed to do matchmaking activity
						is_landed = yes
					}
				}
			}
		}

		scope:actor = {
			is_ai = no
			faith = {
				has_doctrine = tenet_aeluran_sisters
			}
		}

		# scope:recipient = {
			
		# 	# is_councillor_of = scope:host
		# 	# OR = {
		# 	# 	has_trait = aeluran_sister
		# 	# 	has_trait = aeluran_matron
		# 	# 	has_trait = aeluran_high_matriarch
		# 	# }
		# }
	}
	
	cooldown = { years = 1 }

	is_valid_showing_failures_only = {
		scope:actor = {
			is_at_war = no
		}
	}
	
	on_accept = {
		hidden_effect = {
			scope:actor = {
				trigger_event = aeluran_matchmaking.001
			}
		}
	}
	
	cost = {
		# prestige = {
		# 	value = 10
		# }
	}
	
	auto_accept = yes

	# ai_potential = {
	# 	is_ai = no
	# }
	ai_will_do = {
		base = 0
	}
}

# create_aeluran_vassal_interaction = {

# 	category = interaction_category_vassal
# 	common_interaction = yes

# 	desc = grant_titles_interaction_desc

# 	special_interaction = grant_titles_interaction
# 	interface = grant_titles
# 	target_type = title
# 	target_filter = actor_domain_titles
# 	interface_priority = 60

# 	# actor character giving the titles
# 	# recipient character receiving the titles

# 	is_shown = {
# 		NOT = { scope:actor = scope:recipient }
# 		scope:recipient = {
# 			target_is_liege_or_above = scope:actor
# 			is_aeluran_sister_or_higher = yes
# 			is_landed = no
# 		}
# 	}
	
# 	is_valid_showing_failures_only = {

# 	}

# 	can_send = {
		
# 	}

# 	# can_be_picked_title = {
# 	# 	scope:target = {
# 	# 		is_leased_out = no


# 	# 		# trigger_if = {
# 	# 		# 	limit = {
# 	# 		# 		is_head_of_faith = yes
# 	# 		# 		NOT = {
# 	# 		# 			scope:recipient.faith.religious_head = scope:actor.faith.religious_head
# 	# 		# 		}
# 	# 		# 	}
# 	# 		# 	custom_tooltip = {
# 	# 		# 		text = GRANT_TITLES_ITEM_CANT_HEAD_OF_FAITH_TO_INFIDEL
# 	# 		# 		scope:recipient.faith.religious_head = scope:actor.faith.religious_head
# 	# 		# 	}
# 	# 		# }

# 	# 		# trigger_if = {
# 	# 		# 	limit = {
# 	# 		# 		scope:recipient = scope:actor.player_heir
# 	# 		# 		scope:actor = { has_partition_succession_realm_law_trigger = yes }
# 	# 		# 	}
# 	# 		# 	custom_description = {
# 	# 		# 		text = partition_primary_heir_unfair
# 	# 		# 		subject = scope:recipient
# 	# 		# 		current_heir = scope:recipient
# 	# 		# 	}
# 	# 		# }
# 	# 		# trigger_if = {
# 	# 		# 	limit = { scope:target = title:k_fashion }
# 	# 		# 	NOT = { scope:target = title:k_fashion }
# 	# 		# }
# 	# 	}

# 	# 	# custom_description = {
# 	# 	# 	text = grant_titles_interaction_can_only_give_diarch_de_jure_liege_to_diarch
# 	# 	# 	subject = scope:actor.diarch
# 	# 	# 	NAND = {
# 	# 	# 		# Only applies if we have an active diarchy.
# 	# 	# 		scope:actor = { has_active_diarchy = yes }
# 	# 	# 		# Now, prevent us from giving away our diarch's land to invalidate them...
# 	# 	# 		scope:target = {
# 	# 	# 			any_dejure_vassal_title_holder = { this = scope:actor.diarch }
# 	# 	# 			# ... _unless_ we're giving it _to_ the diarch.
# 	# 	# 			NOT = { scope:recipient = scope:actor.diarch }
# 	# 	# 			# Plus we only care if the title is below our tier.
# 	# 	# 			tier < scope:actor.highest_held_title_tier
# 	# 	# 		}
# 	# 	# 	}
# 	# 	# }

# 	# 	# custom_description = {
# 	# 	# 	text = grant_titles_interaction_children_not_allowed_temple
# 	# 	# 	subject = scope:recipient
# 	# 	# 	NOR = {
# 	# 	# 		AND = {
# 	# 	# 			scope:recipient = {
# 	# 	# 				is_adult = no
# 	# 	# 			}
# 	# 	# 			scope:target = {
# 	# 	# 				tier = tier_barony
# 	# 	# 				title_province = { has_building_with_flag = temple }
# 	# 	# 			}
# 	# 	# 		}
# 	# 	# 		AND = {
# 	# 	# 			scope:recipient = {
# 	# 	# 				is_adult = no
# 	# 	# 			}
# 	# 	# 			scope:target = {
# 	# 	# 				tier = tier_county 

# 	# 	# 				title_province = { 
# 	# 	# 					is_county_capital = yes
# 	# 	# 					has_building_with_flag = temple 
# 	# 	# 				}
# 	# 	# 			}
# 	# 	# 		}
# 	# 	# 	}
# 	# 	# }

# 	# 	# custom_description = {
# 	# 	# 	text = grant_titles_interaction_title_being_wagered
# 	# 	# 	NOT = {
# 	# 	# 		scope:target = { has_variable = wagered_county }
# 	# 	# 	}
# 	# 	# }
# 	# }

# 	auto_accept = yes

# 	on_auto_accept = {
# 		# scope:recipient = {
# 		# 	trigger_event = char_interaction.0110
# 		# }
# 	}
	
# 	on_accept = {
# 		# if = {
# 		# 	limit = {
# 		# 		scope:recipient = {
# 		# 			is_acclaimed = yes
# 		# 			liege = {
# 		# 				this = scope:actor
# 		# 			}
# 		# 		}
# 		# 		scope:target = {
# 		# 			tier > tier_barony
# 		# 		}
# 		# 	}
# 		# 	custom_tooltip = grant_title_landing_acclaimed_knight_warning
# 		# }
# 		# scope:recipient = {
# 		# 	if = {
# 		# 		limit = {
# 		# 			is_independent_ruler = yes
# 		# 			save_temporary_scope_as = recipient_is_independent
# 		# 		}
# 		# 	}
# 		# 	if = {
# 		# 		limit = {
# 		# 			NAND = {
# 		# 				has_relation_friend = scope:actor
# 		# 				has_relation_lover = scope:actor
# 		# 				has_relation_soulmate = scope:actor
# 		# 				has_relation_best_friend = scope:actor
# 		# 			}
# 		# 		}
# 		# 		if = {
# 		# 			# then verify the right struggle phase
# 		# 			limit = {
# 		# 				is_diff_faith_or_culture_trigger = {
# 		# 					CHAR = scope:actor
# 		# 					STATUS = involved
# 		# 				}
# 		# 				any_character_struggle = {
# 		# 					involvement = involved
# 		# 					has_struggle_phase_parameter = struggle_grant_titles_diff_faith_culture_to_leads_to_friendship
# 		# 				}
# 		# 			}
# 		# 			progress_towards_friend_effect = {
# 		# 				REASON = friend_granted_title
# 		# 				CHARACTER = scope:actor
# 		# 				OPINION = 0
# 		# 			}
# 		# 		}
# 		# 	}
# 		# }

# 		# if = {
# 		# 	limit = {
# 		# 		any_in_list = {
# 		# 			list = target_titles
# 		# 			tier = tier_county
# 		# 			culture = scope:recipient.culture
# 		# 			NOR = {
# 		# 				culture = scope:actor.culture
# 		# 				recent_history = {
# 		# 					type = granted
# 		# 					years = 10
# 		# 				}
# 		# 			}
# 		# 		}
# 		# 	}
# 		# 	alternative_limit = {
# 		# 		any_in_list = {
# 		# 			list = target_titles
# 		# 			tier >= tier_duchy
# 		# 			title_capital_county = {
# 		# 				NOT = { culture = scope:actor.culture }
# 		# 				culture = scope:recipient.culture
# 		# 			}
# 		# 			NOT = {
# 		# 				recent_history = {
# 		# 					type = granted
# 		# 					years = 10
# 		# 				}
# 		# 			}
# 		# 		}
# 		# 	}
# 		# 	scope:recipient.culture = {
# 		# 		change_cultural_acceptance = {
# 		# 			target = scope:actor.culture
# 		# 			value = grant_title_cultural_acceptance_impact
# 		# 			desc = cultural_acceptance_gain_granted_title
# 		# 		}
# 		# 	}
# 		# }
# 		# if = {
# 		# 	limit = {
# 		# 		any_in_list = {
# 		# 			list = target_titles
# 		# 			tier = tier_county
# 		# 		}
# 		# 		scope:actor.culture = { has_cultural_parameter = grants_to_lowborns_bonuses }
# 		# 		scope:recipient = {
# 		# 			is_lowborn = yes
# 		# 		}
# 		# 	}
# 		# 	every_in_list = {
# 		# 		list = target_titles
# 		# 		limit = { tier = tier_county }
# 		# 		change_county_control = 30
# 		# 	}
# 		# 	scope:recipient = {
# 		# 		add_trait = peasant_leader
# 		# 	}
# 		# }
# 		# if = {
# 		# 	limit = {
# 		# 		any_in_list = {
# 		# 			list = target_titles
# 		# 			tier >= tier_county
# 		# 		}
# 		# 		scope:actor.culture = { has_cultural_parameter = landing_house_members_give_prestige }
# 		# 		exists = scope:actor.house
# 		# 		exists = scope:recipient.house
# 		# 		scope:actor.house = scope:recipient.house
# 		# 	}
# 		# 	scope:actor = {
# 		# 		add_prestige = {
# 		# 			value = 0
# 		# 			every_in_list = {
# 		# 				list = target_titles
# 		# 				limit = { tier = tier_empire }
# 		# 				add = massive_prestige_gain
# 		# 			}
# 		# 			every_in_list = {
# 		# 				list = target_titles
# 		# 				limit = { tier = tier_kingdom }
# 		# 				add = major_prestige_gain
# 		# 			}
# 		# 			every_in_list = {
# 		# 				list = target_titles
# 		# 				limit = { tier = tier_duchy }
# 		# 				add = medium_prestige_gain
# 		# 			}
# 		# 			every_in_list = {
# 		# 				list = target_titles
# 		# 				limit = { tier = tier_county }
# 		# 				add = minor_prestige_gain
# 		# 			}
# 		# 		}
# 		# 	}
# 		# }
# 		# if = {
# 		# 	limit = {
# 		# 		any_in_list = {
# 		# 			list = target_titles
# 		# 			tier >= tier_county
# 		# 		}
# 		# 		scope:actor.culture = { has_cultural_parameter = landing_house_members_gives_renown }
# 		# 		exists = scope:actor.house
# 		# 		exists = scope:recipient.house
# 		# 		scope:actor.house = scope:recipient.house
# 		# 	}
# 		# 	scope:actor.dynasty = {
# 		# 		add_dynasty_prestige = {
# 		# 			value = 0
# 		# 			every_in_list = {
# 		# 				list = target_titles
# 		# 				limit = { tier = tier_empire }
# 		# 				add = massive_dynasty_prestige_gain
# 		# 			}
# 		# 			every_in_list = {
# 		# 				list = target_titles
# 		# 				limit = { tier = tier_kingdom }
# 		# 				add = major_dynasty_prestige_gain
# 		# 			}
# 		# 			every_in_list = {
# 		# 				list = target_titles
# 		# 				limit = { tier = tier_duchy }
# 		# 				add = medium_dynasty_prestige_gain
# 		# 			}
# 		# 			every_in_list = {
# 		# 				list = target_titles
# 		# 				limit = { tier = tier_county }
# 		# 				add = minor_dynasty_prestige_gain
# 		# 			}
# 		# 		}
# 		# 	}
# 		# }

# 		# # Iterate over all given titles
# 		# #  - Add opinion modifiers
# 		# #  - Collect titles that discontent reduction can later be derived from
# 		# every_in_list = {
# 		# 	list = target_titles
# 		# 	save_temporary_scope_as = this_title
# 		# 	if = {
# 		# 		limit = {
# 		# 			exists = scope:landed_title
# 		# 		}
# 		# 		scope:recipient = {
# 		# 			if = {
# 		# 				limit = {
# 		# 					scope:this_title.tier = tier_barony
# 		# 				}

# 		# 				hidden_effect = {
# 		# 					add_opinion = {
# 		# 						target = scope:actor
# 		# 						modifier = received_title_barony
# 		# 					}
# 		# 				}

# 		# 				scope:this_title = { add_to_temporary_list = titles_to_grant }
# 		# 			}

# 		# 			else_if = {
# 		# 				limit = {
# 		# 					scope:this_title.tier = tier_county
# 		# 				}

# 		# 				hidden_effect = {
# 		# 					add_opinion = {
# 		# 						target = scope:actor
# 		# 						modifier = received_title_county
# 		# 					}
# 		# 					if = {
# 		# 						limit = {
# 		# 							is_lowborn = yes
# 		# 						}
# 		# 						scope:actor = {
# 		# 							if = {
# 		# 								limit = {
# 		# 									is_ai = no
# 		# 								}
# 		# 								every_vassal = {
# 		# 									limit = {
# 		# 										has_vassal_stance = courtly
# 		# 									}
# 		# 									add_opinion = {
# 		# 										target = scope:actor
# 		# 										modifier = courtly_lowborn_grant_opinion
# 		# 										opinion = -5
# 		# 									}
# 		# 								}
# 		# 							}
# 		# 							else = { # Can't really stop the AI from landing lowborns, so throttle it a bit so that great conquerors don't annihilate their opinion
# 		# 								random = {
# 		# 									chance = 25
# 		# 									every_vassal = {
# 		# 										limit = {
# 		# 											has_vassal_stance = courtly
# 		# 										}
# 		# 										add_opinion = {
# 		# 											target = scope:actor
# 		# 											modifier = courtly_lowborn_grant_opinion
# 		# 											opinion = -5
# 		# 										}
# 		# 									}
# 		# 								}
# 		# 							}
# 		# 						}
# 		# 					}
# 		# 				}

# 		# 				scope:this_title = { add_to_temporary_list = titles_to_grant }
# 		# 			}

# 		# 			else_if = {
# 		# 				limit = {
# 		# 					scope:this_title.tier = tier_duchy
# 		# 				}

# 		# 				hidden_effect = {
# 		# 					add_opinion = {
# 		# 						target = scope:actor
# 		# 						modifier = received_title_duchy
# 		# 					}
# 		# 					if = {
# 		# 						limit = {
# 		# 							is_lowborn = yes
# 		# 						}
# 		# 						scope:actor = {
# 		# 							every_vassal = {
# 		# 								limit = {
# 		# 									has_vassal_stance = courtly
# 		# 								}
# 		# 								add_opinion = {
# 		# 									target = scope:actor
# 		# 									modifier = courtly_lowborn_grant_opinion
# 		# 									opinion = -20
# 		# 								}
# 		# 							}
# 		# 						}
# 		# 					}
# 		# 				}

# 		# 				scope:this_title = { add_to_temporary_list = titles_to_grant }
# 		# 			}

# 		# 			else_if = {
# 		# 				limit = {
# 		# 					scope:this_title.tier = tier_kingdom
# 		# 				}

# 		# 				hidden_effect = {
# 		# 					add_opinion = {
# 		# 						target = scope:actor
# 		# 						modifier = received_title_kingdom
# 		# 					}
# 		# 					if = {
# 		# 						limit = {
# 		# 							is_lowborn = yes
# 		# 						}
# 		# 						scope:actor = {
# 		# 							every_vassal = {
# 		# 								limit = {
# 		# 									has_vassal_stance = courtly
# 		# 								}
# 		# 								add_opinion = {
# 		# 									target = scope:actor
# 		# 									modifier = courtly_lowborn_grant_opinion
# 		# 									opinion = -50
# 		# 								}
# 		# 							}
# 		# 						}
# 		# 					}
# 		# 				}

# 		# 				scope:this_title = { add_to_temporary_list = titles_to_grant }
# 		# 			}

# 		# 			else_if = {
# 		# 				limit = {
# 		# 					scope:this_title.tier = tier_empire
# 		# 				}

# 		# 				hidden_effect = {
# 		# 					add_opinion = {
# 		# 						target = scope:actor
# 		# 						modifier = received_title_empire
# 		# 					}
# 		# 					if = {
# 		# 						limit = {
# 		# 							is_lowborn = yes
# 		# 						}
# 		# 						scope:actor = {
# 		# 							every_vassal = {
# 		# 								limit = {
# 		# 									has_vassal_stance = courtly
# 		# 								}
# 		# 								add_opinion = {
# 		# 									target = scope:actor
# 		# 									modifier = courtly_lowborn_grant_opinion
# 		# 									opinion = -5
# 		# 								}
# 		# 							}
# 		# 						}
# 		# 					}
# 		# 					if = {
# 		# 						limit = {
# 		# 							is_a_faction_member = yes
# 		# 						}
# 		# 						add_joined_faction_discontent = -60
# 		# 					}
# 		# 				}

# 		# 				scope:this_title = { add_to_temporary_list = titles_to_grant }
# 		# 			}
# 		# 		}

# 		# 		#Promised a vassal this title they had a claim on (vassal.2901)
# 		# 		if = {
# 		# 			limit = {
# 		# 				scope:actor = {
# 		# 					exists = var:was_promised_title
# 		# 					var:was_promised_title = scope:recipient
# 		# 				}
# 		# 			}
# 		# 			if = {
# 		# 				limit = {
# 		# 					scope:recipient = {
# 		# 						exists = var:promised_title
# 		# 					}
# 		# 					scope:landed_title = scope:recipient.var:promised_title
# 		# 				}
# 		# 				scope:actor = {
# 		# 					trigger_event = {
# 		# 						id = vassal.2910
# 		# 						days = { 7 14 }
# 		# 					}
# 		# 				}
# 		# 			}
# 		# 		}
# 		# 	}
# 		# 	if = {
# 		# 		limit = {
# 		# 			scope:recipient = {
# 		# 				has_trait = bastard
# 		# 			}
# 		# 		}
# 		# 		custom_tooltip = grant_title_to_bastard_dynasty_warning
# 		# 	}
# 		# } # every_in_list


# 		# # The accumulated discontent reduction of the recipient
# 		# scope:recipient = {
# 		# 	if = {
# 		# 		limit = {
# 		# 			is_a_faction_member = yes
# 		# 		}
# 		# 		add_joined_faction_discontent = grant_title_opinion_sum_discontent_calc
# 		# 	}
# 		# }

# 		# # Viziers may be booted from their job.
# 		# scope:actor = {
# 		# 	if = {
# 		# 		limit = {
# 		# 			# Assuming this is relevant at all.
# 		# 			diarch ?= scope:recipient
# 		# 			# And that scope:actor can do without a supervisor atm.
# 		# 			can_leave_diarchy_trigger = yes
# 		# 			# Aaaaand that their diarchy supports this type of thing.
# 		# 			OR = {
# 		# 				has_diarchy_parameter = primeminister_requires_county
# 		# 				has_diarchy_parameter = primeminister_requires_duchy
# 		# 			}
# 		# 		}
# 		# 		# Is this a duchy?
# 		# 		if = {
# 		# 			limit = {
# 		# 				any_in_list = {
# 		# 					list = target_titles
# 		# 					tier >= tier_duchy
# 		# 				}
# 		# 			}
# 		# 			custom_tooltip = grant_titles_interaction.tt.primeminister_title_grant.duchy_sufficient
# 		# 			end_diarchy = yes
# 		# 		}
# 		# 		# Is this a county?
# 		# 		else_if = {
# 		# 			limit = {
# 		# 				any_in_list = {
# 		# 					list = target_titles
# 		# 					tier = tier_county
# 		# 				}
# 		# 			}
# 		# 			# Is that insufficient?
# 		# 			if = {
# 		# 				limit = { has_diarchy_active_parameter = primeminister_requires_duchy }
# 		# 				custom_tooltip = grant_titles_interaction.tt.primeminister_title_grant.county_insufficient
# 		# 			}
# 		# 			# Is that sufficient?
# 		# 			else = {
# 		# 				custom_tooltip = grant_titles_interaction.tt.primeminister_title_grant.county_sufficient
# 		# 				end_diarchy = yes
# 		# 			}
# 		# 		}
# 		# 		# Is this a barony?
# 		# 		else_if = {
# 		# 			limit = {
# 		# 				any_in_list = {
# 		# 					list = target_titles
# 		# 					count = all
# 		# 					tier = tier_barony
# 		# 				}
# 		# 			}
# 		# 			custom_tooltip = grant_titles_interaction.tt.primeminister_title_grant.barony_doesnt_end
# 		# 		}
# 		# 	}
# 		# }

# 		# if = {
# 		# 	limit = {
# 		# 		any_in_list = {
# 		# 			list = target_titles
# 		# 			tier = tier_empire
# 		# 		}
# 		# 	}
# 		# 	custom_tooltip = grant_title_modifier_stack_empires
# 		# }
# 		# if = {
# 		# 	limit = {
# 		# 		any_in_list = {
# 		# 			list = target_titles
# 		# 			tier = tier_kingdom
# 		# 		}
# 		# 	}
# 		# 	custom_tooltip = grant_title_modifier_stack_kingdoms
# 		# }
# 		# if = {
# 		# 	limit = {
# 		# 		any_in_list = {
# 		# 			list = titles_to_grant
# 		# 			tier = tier_duchy
# 		# 		}
# 		# 	}
# 		# 	custom_tooltip = grant_title_modifier_stack_duchies
# 		# }
# 		# if = {
# 		# 	limit = {
# 		# 		any_in_list = {
# 		# 			list = titles_to_grant
# 		# 			tier = tier_county
# 		# 		}
# 		# 	}
# 		# 	custom_tooltip = grant_title_modifier_stack_counties
# 		# }
# 		# if = {
# 		# 	limit = {
# 		# 		any_in_list = {
# 		# 			list = titles_to_grant
# 		# 			tier = tier_barony
# 		# 		}
# 		# 	}
# 		# 	custom_tooltip = grant_title_modifier_stack_baronies
# 		# }
# 		# if = {
# 		# 	limit = {
# 		# 		trigger_if = {
# 		# 			limit = { scope:actor = { is_ai = yes } }
# 		# 			scope:actor = {
# 		# 				any_vassal = {
# 		# 					has_vassal_stance = courtly
# 		# 				}
# 		# 			}
# 		# 		}
# 		# 		scope:recipient = {
# 		# 			is_lowborn = yes
# 		# 		}
# 		# 		any_in_list = {
# 		# 			list = titles_to_grant
# 		# 			tier >= tier_county
# 		# 		}
# 		# 	}
# 		# 	custom_tooltip = grant_title_modifier_courtly_lowborn_grant_penalty
# 		# }
# 		# if = {
# 		# 	limit = {
# 		# 		scope:recipient = { is_a_faction_member = yes }
# 		# 	}
# 		# 	custom_tooltip = grant_title_modifier_stack_discontent
# 		# }

# 		# # Jealousy check
# 		# if = {
# 		# 	limit = {
# 		# 		any_in_list = {
# 		# 			list = titles_to_grant
# 		# 			any_claimant = { grant_title_rivalry_trigger = yes }
# 		# 		}
# 		# 	}
# 		# 	hidden_effect = {
# 		# 		random = {
# 		# 			chance = 25
# 		# 			ordered_in_list = {
# 		# 				list = titles_to_grant
# 		# 				limit = {
# 		# 					any_claimant = { grant_title_rivalry_trigger = yes }
# 		# 				}
# 		# 				order_by = tier
# 		# 				save_scope_as = claim_title
# 		# 				ordered_claimant = {
# 		# 					limit = { grant_title_rivalry_trigger = yes }
# 		# 					order_by = primary_title.tier
# 		# 					save_scope_as = claim_vassal
# 		# 					if = {
# 		# 						limit = {
# 		# 							scope:recipient = { is_lowborn = yes }
# 		# 						}
# 		# 						scope:recipient = { save_scope_as = lowborn_scope }
# 		# 					}
# 		# 					else_if = {
# 		# 						limit = {
# 		# 							scope:recipient = { has_claim_on = scope:claim_title }
# 		# 						}
# 		# 						scope:recipient = { save_scope_as = claimant_scope }
# 		# 					}
# 		# 					scope:actor = {
# 		# 						trigger_event = {
# 		# 							id = bp1_yearly.8070
# 		# 							days = 5
# 		# 						}
# 		# 					}
# 		# 				}
# 		# 			}
# 		# 		}
# 		# 	}
# 		# }

# 		# #Stress impact
# 		# scope:actor = {
# 		# 	if = {
# 		# 		limit = {
# 		# 			any_in_list = {
# 		# 				list = target_titles
# 		# 				trigger_if = {
# 		# 					limit = { tier = tier_barony }
# 		# 					title_province.barony = {
# 		# 						has_wrong_holding_type = no
# 		# 					}
# 		# 				}
# 		# 				count >= 1
# 		# 			}
# 		# 		}
				
# 		# 		# Generous characters enjoy giving away titles
# 		# 		if = {
# 		# 			limit = {
# 		# 				has_trait = generous
# 		# 			}
# 		# 			add_stress = generous_title_grant_value
# 		# 		}

# 		# 		# Gnostics lose stress for giving away titles.
# 		# 		if = {
# 		# 			limit = {
# 		# 				scope:actor = {
# 		# 					faith = {
# 		# 						has_doctrine_parameter = granting_titles_gives_stress
# 		# 					}
# 		# 				}
# 		# 			}
# 		# 			scope:actor = {
# 		# 				add_stress = {
# 		# 					value = 0

# 		# 					# Base stress value scaled on title tier.
# 		# 					every_in_list = {
# 		# 						list = target_titles

# 		# 						add = {
# 		# 							value = 0

# 		# 							if = {
# 		# 								limit = { this.tier = tier_county }
# 		# 								add = minor_stress_loss # 10 base
# 		# 							}
# 		# 							else_if = {
# 		# 								limit = { this.tier = tier_duchy }
# 		# 								add = {
# 		# 									value = medium_stress_loss
# 		# 									multiply = 1.25 # 25 base
# 		# 								}
# 		# 							}
# 		# 							else_if = {
# 		# 								limit = { this.tier = tier_kingdom }
# 		# 								add = {
# 		# 									value = major_stress_loss
# 		# 									multiply = 2 # 80 base
# 		# 								}
# 		# 							}
# 		# 							else_if = {
# 		# 								limit = { this.tier = tier_empire }
# 		# 								add = {
# 		# 									value = monumental_stress_loss 
# 		# 									multiply = 2 # 200 base
# 		# 								}
# 		# 							}

# 		# 							# Lose more stress for giving away titles of your primary tier; lose less stress for giving away titles far below your primary in tier.
# 		# 							multiply = {
# 		# 								value = this.tier
# 		# 								add = 1
# 		# 								divide = scope:actor.primary_title.tier
# 		# 							}

# 		# 							# Round to the nearest multiple of 5.
# 		# 							divide = 5
# 		# 							round = yes
# 		# 							multiply = 5

# 		# 							# For a Duke, this will be x1.25 for Duchies (-30) and x1 for Counties(-10)
# 		# 							# For a King, this will be x1.25 for a Kingdom (-100), x1 for a Duchy (-25) and x0.75 for Counties(-10)
# 		# 							# For an Emperor, this will be x1.25 for an Empire(-200), x1 for a Kingdom(-80), x0.75 for a Duchy(-20) and x0.4 for a Counties (-5)
# 		# 						}
# 		# 					}
# 		# 				}
# 		# 			}
# 		# 		}

# 		# 		# Greedy & ambitious ruler gain stress for giving away titles if they would normally be able to keep them.
# 		# 		if = {
# 		# 			limit = {
# 		# 				# Pre-filter 
# 		# 				OR = {
# 		# 					has_trait = greedy
# 		# 					has_trait = ambitious
# 		# 				}
# 		# 				domain_size <= domain_limit # Not over my domain limit
# 		# 				any_in_list = {
# 		# 					list = target_titles
# 		# 					tier <= tier_county # At least 1 selected title counts toward domain limit
# 		# 				}

# 		# 				# Special exemption for lieges who are over their held duchy limit, which are giving away that duchy (and associated counties) specifically
# 		# 				trigger_if = {
# 		# 					limit = {
# 		# 						has_too_many_held_duchies_trigger = yes
# 		# 					}
# 		# 					NOT = {				
# 		# 						# Granting at least 1 duchy
# 		# 						any_in_list = {
# 		# 							list = target_titles
# 		# 							title_counts_towards_too_many_duchies_trigger = yes
# 		# 							save_temporary_scope_as = granted_duchy

# 		# 							# All counties being granted are De Jure part of the duchy that is being granted
# 		# 							any_in_list = {
# 		# 								list = target_titles
# 		# 								count = all 
# 		# 								trigger_if = {
# 		# 									limit = { tier = tier_county}
# 		# 									de_jure_liege = scope:granted_duchy
# 		# 								}
# 		# 							}
# 		# 						}
# 		# 					}
# 		# 				}
# 		# 			}
# 		# 			# Actual stress gain effects
# 		# 			if = {
# 		# 				limit = {
# 		# 					domain_size = domain_limit
# 		# 				}
# 		# 				stress_impact = {
# 		# 					greedy = minor_stress_impact_gain
# 		# 					ambitious = minor_stress_impact_gain
# 		# 				}
# 		# 			}
# 		# 			else_if = {
# 		# 				limit = {
# 		# 					domain_size < domain_limit
# 		# 				}
# 		# 				stress_impact = {
# 		# 					greedy = medium_stress_impact_gain
# 		# 					ambitious = medium_stress_impact_gain
# 		# 				}
# 		# 			}
# 		# 		}
# 		# 	}

# 		# 	# Maintenance for runestones
# 		# 	if = {
# 		# 		limit = {
# 		# 			# Use expanded version if we have FP1.
# 		# 			has_fp1_dlc_trigger = yes
# 		# 			fp1_remove_stele_new_holder_trigger = {
# 		# 				TITLE = scope:target
# 		# 				PREVIOUS_HOLDER = scope:actor
# 		# 				NEW_HOLDER = scope:recipient
# 		# 			}
# 		# 		}
# 		# 		# Actually removed in fp1_other_decisions.0113
# 		# 		custom_tooltip = runestone_grant_title_warning
# 		# 	}
# 		# 	else_if = {
# 		# 		limit = {
# 		# 			scope:target = {
# 		# 				exists = var:ancestor_to_bury
# 		# 				has_county_modifier = county_raised_runestone_modifier
# 		# 			}
# 		# 			NOT = { scope:recipient.dynasty = var:ancestor_to_bury.dynasty } #We only have to change something if the new holder is of a different dynasty
# 		# 		}
# 		# 		# Actually removed in religious_decision.0312
# 		# 		custom_tooltip = runestone_grant_title_warning
# 		# 	}
			
# 		# 	if = {
# 		# 		limit = {
# 		# 			exists = scope:actor.dynasty
# 		# 			scope:actor.dynasty = {
# 		# 				has_dynasty_perk = ep1_culture_legacy_3
# 		# 			}
# 		# 			scope:recipient = {
# 		# 				is_landed = no
# 		# 				NOT = {
# 		# 					culture = scope:actor.culture
# 		# 				}
# 		# 				any_in_list = {
# 		# 					list = target_titles
# 		# 					OR = {
# 		# 						tier = tier_county
# 		# 						tier = tier_barony
# 		# 					}
# 		# 					culture = scope:recipient.culture
# 		# 				}
# 		# 			}
# 		# 		}
# 		# 		scope:actor = {
# 		# 			if = {
# 		# 				limit = {
# 		# 					can_add_hook = {
# 		# 						target = scope:recipient
# 		# 						type = favor_hook
# 		# 					}
# 		# 				}
# 		# 				add_hook = {
# 		# 					type = favor_hook
# 		# 					target = scope:recipient
# 		# 				}
# 		# 			}
# 		# 		}
# 		# 	}

# 		# 	#Feedback for actor
# 		# 	hidden_effect = {
# 		# 		if = {
# 		# 			limit = {
# 		# 				any_in_list = {
# 		# 					list = target_titles
# 		# 					count = 1
# 		# 					NOT = { tier = scope:actor.highest_held_title_tier }
# 		# 				}
# 		# 				NOT = { exists = scope:recipient_is_independent }
# 		# 				scope:recipient = {
# 		# 					any_held_title = {
# 		# 						tier > tier_barony
# 		# 						NOT = {
# 		# 							is_in_list = target_titles
# 		# 						}
# 		# 					}
# 		# 				}
# 		# 			}
# 		# 			random_in_list = {
# 		# 				list = target_titles
# 		# 				save_temporary_scope_as = loc_title
# 		# 			}
# 		# 			send_interface_toast = {
# 		# 				title = grant_titles_interaction_notification
					
# 		# 				left_icon = scope:actor					
# 		# 				right_icon = scope:recipient
					
# 		# 				custom_tooltip = grant_titles_interaction_notification_effect_2
# 		# 				if = {
# 		# 					limit = {
# 		# 						exists = dynasty
# 		# 						is_diff_faith_or_culture_trigger = {
# 		# 							CHAR = scope:recipient
# 		# 							STATUS = involved
# 		# 						}
# 		# 						any_character_struggle = {
# 		# 							involvement = involved
# 		# 							has_struggle_phase_parameter = struggle_grant_titles_diff_faith_culture_gives_prestige

# 		# 						}
# 		# 					}
# 		# 					dynasty = {
# 		# 						add_dynasty_prestige = minor_dynasty_prestige_gain
# 		# 					}

# 		# 				}
# 		# 			}
# 		# 		}
# 		# 		else_if = {
# 		# 			limit = {
# 		# 				any_in_list = {
# 		# 					list = target_titles
# 		# 					count > 1
# 		# 					NOT = { tier = scope:actor.highest_held_title_tier }
# 		# 				}
# 		# 				NOT = { exists = scope:recipient_is_independent }
# 		# 				scope:recipient = {
# 		# 					any_held_title = {
# 		# 						tier > tier_barony
# 		# 						NOT = {
# 		# 							is_in_list = target_titles
# 		# 						}
# 		# 					}
# 		# 				}
# 		# 			}
# 		# 			random_in_list = {
# 		# 				list = target_titles
# 		# 				save_temporary_scope_as = loc_title
# 		# 			}
# 		# 			send_interface_toast = {
# 		# 				title = grant_titles_interaction_notification
					
# 		# 				left_icon = scope:actor					
# 		# 				right_icon = scope:recipient
					
# 		# 				custom_tooltip = grant_titles_interaction_notification_effect_3
# 		# 			}
# 		# 		}
# 		# 		else_if = {
# 		# 			limit = {
# 		# 				exists = scope:recipient_is_independent
# 		# 			}

# 		# 			random_in_list = {
# 		# 				list = target_titles
# 		# 				save_temporary_scope_as = loc_title
# 		# 			}
# 		# 			send_interface_toast = {
# 		# 				title = grant_titles_interaction_notification
					
# 		# 				left_icon = scope:actor					
# 		# 				right_icon = scope:recipient
					
# 		# 				custom_tooltip = grant_titles_interaction_notification_effect_6
# 		# 			}
# 		# 		}
# 		# 		else_if = {
# 		# 			limit = {
# 		# 				scope:recipient = {
# 		# 					any_in_list = { #Became independent from you, but still have the same liege
# 		# 						list = target_titles
# 		# 						tier = scope:actor.highest_held_title_tier
# 		# 					}
# 		# 					top_liege = scope:actor.top_liege
# 		# 				}
# 		# 			}
# 		# 			send_interface_toast = {
# 		# 				title = grant_titles_interaction_notification
					
# 		# 				left_icon = scope:actor					
# 		# 				right_icon = scope:recipient
					
# 		# 				custom_tooltip = grant_titles_interaction_notification_effect_5
# 		# 			}
# 		# 		}
# 		# 		else_if = {
# 		# 			limit = {
# 		# 				scope:recipient = {
# 		# 					any_in_list = { #Became independent
# 		# 						list = target_titles
# 		# 						tier = scope:actor.highest_held_title_tier
# 		# 					}
# 		# 				}
# 		# 			}
# 		# 			send_interface_toast = {
# 		# 				title = grant_titles_interaction_notification
					
# 		# 				left_icon = scope:actor					
# 		# 				right_icon = scope:recipient
					
# 		# 				custom_tooltip = grant_titles_interaction_notification_effect_4
# 		# 			}
# 		# 		}
# 		# 		else = {
# 		# 			send_interface_toast = {
# 		# 				title = grant_titles_interaction_notification

# 		# 				left_icon = scope:actor					
# 		# 				right_icon = scope:recipient

# 		# 				custom_tooltip = grant_titles_interaction_notification_effect
# 		# 			}
# 		# 		}
# 		# 	}
# 		# }

# 		# hidden_effect = {
# 		# 	# Struggle Catalyst
# 		# 	if = {
# 		# 		limit = {
# 		# 			scope:actor = {
# 		# 				is_diff_faith_or_culture_trigger = {
# 		# 					CHAR = scope:recipient
# 		# 					STATUS = involved
# 		# 				}
# 		# 				any_character_struggle = {
# 		# 					involvement = involved
# 		# 					activate_struggle_catalyst_secondary_character_involvement_involved_trigger = {
# 		# 						CATALYST = catalyst_grant_privilege_to_diff_faith_culture_vassal
# 		# 						CHAR = scope:recipient
# 		# 					}
# 		# 				}
# 		# 			}
# 		# 		}
# 		# 		scope:actor = {
# 		# 			every_character_struggle = {
# 		# 				involvement = involved
# 		# 				limit = {
# 		# 					activate_struggle_catalyst_secondary_character_involvement_involved_trigger = {
# 		# 						CATALYST = catalyst_grant_privilege_to_diff_faith_culture_vassal
# 		# 						CHAR = scope:recipient
# 		# 					}
# 		# 				}
# 		# 				activate_struggle_catalyst = {
# 		# 					catalyst = catalyst_grant_privilege_to_diff_faith_culture_vassal
# 		# 					character = scope:actor
# 		# 				}
# 		# 			}
# 		# 		}
# 		# 	}
# 		# }

# 		# # Achievements.
# 		# scope:actor = {
# 		# 	if = {
# 		# 		limit = {
# 		# 			has_variable_list = candidate_a_knights_tale_achievement
# 		# 			is_target_in_variable_list = {
# 		# 				name = candidate_a_knights_tale_achievement
# 		# 				target = scope:recipient
# 		# 			}
# 		# 		}
# 		# 		set_global_variable = {
# 		# 			name = finished_a_knights_tale_achievement
# 		# 			value = yes
# 		# 		}
# 		# 	}
# 		# }
# 	}
# }

sister_convert_me_to_aeluran_interaction = {
	category = interaction_category_religion
	interface_priority = 60
	icon = icon_aeluran_sister

	desc = convert_me_to_aeluran_desc
	use_diplomatic_range = no
	common_interaction = yes
	
	is_shown = {
		NOT = { scope:recipient = scope:actor }

		scope:actor = {
			is_ai = no
			NOT = {
				faith = faith:aeluran_weavers
			}
		}

		scope:recipient = {
			has_trait = aeluran_sister
		}
	}
	
	cooldown = { years = 2 }

	is_valid_showing_failures_only = {

	}
	
	on_accept = {
		hidden_effect = {
			scope:actor = {
				trigger_event = aeluran_character_interaction.001
			}
		}
	}
	
	cost = {
		prestige = {
			value = 10
		}
	}
	
	auto_accept = yes

	# ai_potential = {
	# 	is_ai = no
	# }
	ai_will_do = {
		base = 0
	}
}
matron_convert_me_to_aeluran_interaction = {
	category = interaction_category_religion
	interface_priority = 60
	icon = icon_aeluran_matron

	desc = convert_me_to_aeluran_desc
	use_diplomatic_range = no
	common_interaction = yes
	
	is_shown = {
		NOT = { scope:recipient = scope:actor }

		scope:actor = {
			is_ai = no
			NOT = {
				faith = faith:aeluran_weavers
			}
		}

		scope:recipient = {
			has_trait = aeluran_matron
		}
	}
	
	cooldown = { years = 2 }

	is_valid_showing_failures_only = {

	}
	
	on_accept = {
		hidden_effect = {
			scope:actor = {
				trigger_event = aeluran_character_interaction.001
			}
		}
	}
	
	cost = {
		prestige = {
			value = 10
		}
	}
	
	auto_accept = yes

	# ai_potential = {
	# 	is_ai = no
	# }
	ai_will_do = {
		base = 0
	}
}
matriarch_convert_me_to_aeluran_interaction = {
	category = interaction_category_religion
	interface_priority = 60
	icon = icon_aeluran_high_matriarch

	desc = convert_me_to_aeluran_desc
	use_diplomatic_range = no
	common_interaction = yes
	
	is_shown = {
		NOT = { scope:recipient = scope:actor }

		scope:actor = {
			is_ai = no
			NOT = {
				faith = faith:aeluran_weavers
			}
		}

		scope:recipient = {
			has_trait = aeluran_high_matriarch
		}
	}
	
	cooldown = { years = 2 }

	is_valid_showing_failures_only = {

	}
	
	on_accept = {
		hidden_effect = {
			scope:actor = {
				trigger_event = aeluran_character_interaction.001
			}
		}
	}
	
	cost = {
		prestige = {
			value = 10
		}
	}
	
	auto_accept = yes

	# ai_potential = {
	# 	is_ai = no
	# }
	ai_will_do = {
		base = 0
	}
}

sister_change_gender_of_unborn = {
	category = interaction_category_religion
	interface_priority = 60
	icon = icon_aeluran_sister

	desc = change_gender_of_unborn_desc
	use_diplomatic_range = no
	common_interaction = yes
	
	is_shown = {
		scope:actor = {
			is_ai = no
		}

		scope:recipient = {
			has_trait = aeluran_sister
			is_pregnant = yes
			# TODO: baby is child of actor check
		}
	}
	
	cooldown = { years = 1 }

	is_valid_showing_failures_only = {

	}
	
	on_accept = {
		hidden_effect = {
			scope:actor = {
				trigger_event = aeluran_character_interaction.002
			}
		}
	}
	
	cost = {
		prestige = {
			value = 10
		}
	}
	
	auto_accept = yes

	# ai_potential = {
	# 	is_ai = no
	# }
	ai_will_do = {
		base = 0
	}
}
matron_change_gender_of_unborn = {
	category = interaction_category_religion
	interface_priority = 60
	icon = icon_aeluran_matron

	desc = change_gender_of_unborn_desc
	use_diplomatic_range = no
	common_interaction = yes
	
	is_shown = {
		scope:actor = {
			is_ai = no
		}

		scope:recipient = {
			has_trait = aeluran_matron
			is_pregnant = yes
			# TODO: baby is child of actor check
		}
	}
	
	cooldown = { years = 1 }

	is_valid_showing_failures_only = {

	}
	
	on_accept = {
		hidden_effect = {
			scope:actor = {
				trigger_event = aeluran_character_interaction.002 
			}
		}
	}
	
	cost = {
		prestige = {
			value = 10
		}
	}
	
	auto_accept = yes

	# ai_potential = {
	# 	is_ai = no
	# }
	ai_will_do = {
		base = 0
	}
}
matriarch_change_gender_of_unborn = {
	category = interaction_category_religion
	interface_priority = 60
	icon = icon_aeluran_high_matriarch

	desc = change_gender_of_unborn_desc
	use_diplomatic_range = no
	common_interaction = yes
	
	is_shown = {
		scope:actor = {
			is_ai = no
		}

		scope:recipient = {
			has_trait = aeluran_high_matriarch
			is_pregnant = yes
			# TODO: baby is child of actor check
		}
	}
	
	cooldown = { years = 1 }

	is_valid_showing_failures_only = {

	}
	
	on_accept = {
		hidden_effect = {
			scope:actor = {
				trigger_event = aeluran_character_interaction.002 
			}
		}
	}
	
	cost = {
		prestige = {
			value = 10
		}
	}
	
	auto_accept = yes

	# ai_potential = {
	# 	is_ai = no
	# }
	ai_will_do = {
		base = 0
	}
}


# Liege (actor) selects a vizier to help them run the realm.
appoint_aeluran_advisor_interaction = {
	category = interaction_category_diarch
	icon = icon_declare_me_regent

	desc = appoint_vizier_interaction_desc
	interface_priority = 20

	is_shown = {
		scope:actor = {
			is_ai = no
		}
	}

	is_valid_showing_failures_only = {

	}

	# cooldown = {}

	populate_recipient_list = { sort_aeluran_candidates_to_list_effect = yes }

	cost = {

	}

	auto_accept = yes

	pre_auto_accept = {
		# If we're an AI, set the secondary_recipient up for us.
		scope:actor = {
			if = {
				limit = { is_ai = yes }
				# First, we need to calc who _is_ most qualified; we don't have access to the character list any more, so reassemble it.
				sort_aeluran_candidates_to_list_effect = yes
				# Now, parse through the the list to find the best character.
				ordered_in_list = {
					list = characters
					order_by = diarchy_vizier_succession_score_value
					save_scope_as = ai_recipient
				}
			}
		}
	}

	on_accept = {
		scope:actor = {
			# We enter into a vizierate with scope:secondary_recipient.
			custom_tooltip = {
				text = appoint_vizier_interaction.tt.enter_vizierate_with_secondary_recipient
				start_diarchy = aeluran_regency
				# The player uses scope:secondary_recipient.
				if = {
					limit = {
						# We use a NOT here  rather than is_ai = no because the AI was occasionally managing to bork its selection process, and the title does _not_ like setting an empty diarch, so we fallback AI who can't behave to a sub-optimal choice.
						NOT = { exists = scope:ai_recipient }
					}
					set_diarch = scope:secondary_recipient
				}
				# Whereas the AI grabs their pre-selected candidate.
				else = {
					set_diarch = scope:ai_recipient
				}
			}
			# Apply opinion.
			## AI.
			if = {
				limit = { exists = scope:ai_recipient }
				scope:ai_recipient = {
					add_opinion = {
						target = scope:actor
						modifier = compliment_opinion
						opinion = 30
					}
					stress_impact = {
						ambitious = minor_stress_impact_loss
						arrogant = minor_stress_impact_loss
						lazy = major_stress_impact_gain
					}
				}
			}
			## Player.
			else = {
				scope:secondary_recipient = {
					add_opinion = {
						target = scope:actor
						modifier = compliment_opinion
						opinion = 30
					}
					stress_impact = {
						ambitious = minor_stress_impact_loss
						arrogant = minor_stress_impact_loss
						lazy = major_stress_impact_gain
					}
				}
			}
			# And get X tax jurisdictions.
			custom_tooltip = appoint_vizier_interaction.tt.secondary_recipient_grants_tax_jurisdictions
			# If scope:secondary_recipient isn't the most qualified candidate, we'll take a scaling negative stewardship modifier.
			## The AI will always pick the highest scoring character, so we only do this for players - lock it off so we're not doing lots of unnecessary calculating.
			if = {
				limit = { is_ai = no }
				# First, we need to calc who _is_ most qualified; we don't have access to the character list any more, so reassemble it.
				sort_aeluran_candidates_to_list_effect = yes
				# Now, parse through the the list to find the best character.
				ordered_in_list = {
					list = characters
					order_by = diarchy_vizier_succession_score_value
					save_scope_as = best_candidate
				}
				# Is our chap _the_ chap?
				if = {
					limit = {
						NOT = { scope:secondary_recipient = scope:best_candidate }
					}
					# Ok, now display some warnings.
					custom_tooltip = appoint_vizier_interaction.tt.secondary_recipient_is_not_best_candidate
					add_character_modifier = {
						modifier = civil_service_upset_modifier
						years = 10
					}
				}
			}
			# Are they of our house?
			if = {
				limit = {
					exists = scope:secondary_recipient.house
					house ?= scope:secondary_recipient.house
				}
				custom_tooltip = appoint_vizier_interaction.tt.same_house_penalty
			}
			# If we have a designated diarch (and it's not this guy), then they're annoyed.
			designated_diarch ?= {
				if = {
					limit = {
						NOT = { this = scope:secondary_recipient }
					}
					add_opinion = {
						target = scope:actor
						modifier = appointed_vizier_over_designated_regent_opinion
						opinion = -40
					}
				}
			}
			# Set a reminder that we appointed this vizier — the AI'll use this to help with determining whether they should remove them or not.
			set_variable = {
				name = my_vizier
				value = scope:recipient
			}
			# Finally, let's do some stress.
			stress_impact = {
				trusting = massive_stress_impact_loss
				lazy = major_stress_impact_loss
				paranoid = minor_stress_impact_gain
				diligent = minor_stress_impact_gain
			}
		}
		# Notify about council problemos.
		scope:secondary_recipient = {
			if = {
				limit = { is_councillor = yes }
				custom_tooltip = appoint_vizier_interaction.tt.warning.vizier_replace_councillor
			}
		}
		
		# Object explorer logging.
		scope:actor = {
			diarch_interaction_set_or_update_global_variable_effect = { VARIABLE = di_track_appviz_accept }
			diarch_interaction_add_to_global_list_effect = { VARIABLE_LIST = di_track_appviz_accept_actor_list }
		}
		scope:recipient = {
			diarch_interaction_add_to_global_list_effect = { VARIABLE_LIST = di_track_appviz_accept_recipient_list }
		}
	}

	# AI
	ai_targets = { ai_recipients = self }
	ai_frequency = 240
	
	ai_potential = {
		government_has_flag = may_appoint_viziers
	}
	
	ai_will_do = {
		base = 0

		# Realm.
		## Weight up for kings.
		modifier = {
			add = 50
			highest_held_title_tier = tier_kingdom
		}
		## Weight up for emperors.
		modifier = {
			add = 75
			highest_held_title_tier >= tier_empire
		}
		## Add realm size directly.
		modifier = {
			add = sub_realm_size
			is_landed = yes
		}

		# Traits.
		## +++ Lazy.
		modifier = {
			add = 25
			has_trait = lazy
		}
		## +++ Greedy.
		modifier = {
			add = 25
			has_trait = greedy
		}
		## ++ Humble.
		modifier = {
			add = 15
			has_trait = humble
		}
		## ++ Content.
		modifier = {
			add = 15
			has_trait = content
		}
		## ++ Impatient.
		modifier = {
			add = 15
			has_trait = impatient
		}
		## + Content.
		modifier = {
			add = 5
			has_trait = content
		}
		## + Shy.
		modifier = {
			add = 5
			has_trait = shy
		}
		## - Gregarious.
		modifier = {
			add = -5
			has_trait = gregarious
		}
		## -- Patient.
		modifier = {
			add = -15
			has_trait = patient
		}
		## -- Diligent.
		modifier = {
			add = -15
			has_trait = diligent
		}
		## --- Arrogant.
		modifier = {
			add = -25
			has_trait = arrogant
		}
		## --- Ambitious.
		modifier = {
			add = -25
			has_trait = ambitious
		}
	}
	
}


swing_aeluran_control_interaction = {
	category = interaction_category_diarch
	common_interaction = yes
	highlighted_reason = HIGHLIGHTED_CAN_SWING_SCALES
	icon = scroll_scales

	desc = swing_scales_currency_interaction_desc

	interface_priority = 242

	is_shown = {
		# You must be one of the partners in a diarchy.
		# is_ai = no
		OR = {
			scope:actor = { is_diarch_of_target = scope:recipient }
			scope:recipient = { is_diarch_of_target = scope:actor }
		}
	}

	is_valid_showing_failures_only = {
		# Forbid when we're at max swing...
		## ... for the regent.
		trigger_if = {
			limit = {
				scope:actor = { is_diarch_of_target = scope:recipient }
			}
			custom_tooltip = {
				text = swing_scales_currency_interaction.tt.scales_max_swung
				scope:recipient.diarchy_swing < 100
			}
		}
		## ... and for the liege.
		trigger_else = {
			custom_tooltip = {
				text = swing_scales_currency_interaction.tt.scales_max_swung
				scope:actor.diarchy_swing > 0
			}
		}
		# As long as you're able to give something even vaguely like an order to someone who might advocate on your behalf, you're gucci.
		scope:actor = {
			is_imprisoned = no
			age >= 8
		}
		# Must select something.
		trigger_if = {
			# AI won't exploit and need this exception, as they don't actually open the windows, so they'll be blocked from taking the interaction otherwise.
			limit = {
				scope:actor = { is_ai = no }
			}
			custom_tooltip = {
				text = interactions_general.tt.must_select_one_option
				OR = {
					scope:challenge_type_learning = yes
					scope:challenge_type_intrigue_diplomacy = yes
					# scope:swing_piety = yes
					# scope:swing_gold = yes
					# scope:swing_hook = yes
					# scope:swing_hof = yes
				}
			}
		}
	}

	cooldown = { years = 2 }

	cost = {
		# prestige = {
		# 	if = {
		# 		limit = { always = scope:swing_prestige }
		# 		value = scope:actor.swing_scales_prestige_cost_value
		# 		# LEGITIMACY OF RULER AFFECTS COSTS FOR REGENTS
		# 		if = {
		# 			limit = { scope:actor = { is_valid_for_legitimacy_change = yes } }
		# 			multiply = legitimacy_regent_swing_scale_multipler_value
		# 		}
		# 	}
		# }
		# piety = {
		# 	if = {
		# 		limit = {
		# 			OR = {
		# 				always = scope:swing_piety
		# 				always = scope:swing_hof
		# 			}
		# 		}
		# 		value = scope:actor.swing_scales_piety_cost_value
		# 		# LEGITIMACY OF RULER AFFECTS COSTS FOR REGENTS
		# 		if = {
		# 			limit = { scope:actor = { is_valid_for_legitimacy_change = yes } }
		# 			multiply = legitimacy_regent_swing_scale_multipler_value
		# 		}
		# 	}
		# }
		# gold = {
		# 	if = {
		# 		limit = {
		# 			OR = {
		# 				always = scope:swing_gold
		# 				always = scope:swing_hof
		# 			}
		# 		}
		# 		value = scope:actor.swing_scales_cash_cost_value
		# 		# LEGITIMACY OF RULER AFFECTS COSTS FOR REGENTS
		# 		if = {
		# 			limit = { scope:actor = { is_valid_for_legitimacy_change = yes } }
		# 			multiply = legitimacy_regent_swing_scale_multipler_value
		# 		}
		# 	}
		# }
	}

	send_option = { # Learning
		starts_enabled = { always = yes }
		flag = challenge_type_learning
		localization = BOW_LEARNING
		current_description = BOW_LEARNING_DESC
	}

	send_option = { # Intrigue and Diplomacy
		# starts_enabled = { always = yes }
		is_shown = {
			scope:actor.culture = {
				has_cultural_parameter = entrance_scheme_unlocked
			}
		}

		is_valid = {
			scope:actor.culture = {
				has_cultural_parameter = entrance_scheme_unlocked
			}
		}

		flag = challenge_type_intrigue_diplomacy
		localization = BOW_DIPLO_AND_INTRIGUE
		current_description = BOW_DIPLO_AND_INTRIGUE_DESC
	}

	# Prestige
	# send_option = {
	# 	starts_enabled = { scope:actor.prestige >= scope:actor.swing_scales_prestige_cost_value }
	# 	flag = swing_prestige
	# 	localization = SWING_PRESTIGE
	# 	current_description = SWING_PRESTIGE_DESC
	# }
	# # Piety
	# send_option = {
	# 	is_valid = {
	# 		# You must share a HoF to be able to petition one.
	# 		custom_tooltip = {
	# 			text = swing_scales_currency_interaction.tt.no_shared_hof
	# 			# We're also secretly just testing if characters are the same faith.
	# 			OR = {
	# 				scope:actor.faith = scope:recipient.faith
	# 				AND = {
	# 					exists = scope:actor.faith.religious_head
	# 					exists = scope:recipient.faith.religious_head
	# 					scope:actor.faith.religious_head = scope:recipient.faith.religious_head
	# 				}
	# 			}
	# 		}
	# 	}
	# 	starts_enabled = { scope:actor.piety >= scope:actor.swing_scales_piety_cost_value }
	# 	flag = swing_piety
	# 	localization = SWING_PIETY
	# 	current_description = SWING_PIETY_DESC
	# }
	# # Gold
	# send_option = {
	# 	is_shown = {
	# 		# Filter out for the liege in vizierates - they can mulct the vizier, so we don't give them the chance to spend that gold back.
	# 		interaction_actor_is_liege_with_vizierate_trigger = no
	# 	}
	# 	starts_enabled = { scope:actor.gold >= scope:actor.swing_scales_cash_cost_value }
	# 	flag = swing_gold
	# 	localization = SWING_GOLD
	# 	current_description = SWING_GOLD_DESC
	# }
	# # Hook
	# send_option = {
	# 	is_valid = {
	# 		scope:actor = { has_usable_hook = scope:recipient }
	# 	}
	# 	starts_enabled = {
	# 		scope:actor = { has_usable_hook = scope:recipient }
	# 	}
	# 	flag = swing_hook
	# 	localization = SWING_HOOK
	# 	current_description = SWING_HOOK_DESC
	# }
	# # HoF
	# send_option = {
	# 	is_shown = {
	# 		# Filter out for the liege in vizierates - they can mulct the vizier, so we don't give them the chance to spend that gold back.
	# 		interaction_actor_is_liege_with_vizierate_trigger = no
	# 	}
	# 	is_valid = { diarch_swing_scales_valid_shared_hof_trigger = yes }
	# 	# Top of the prio order for enablement.
	# 	starts_enabled = { diarch_swing_scales_valid_shared_hof_trigger = yes }
	# 	flag = swing_hof
	# 	localization = SWING_HOF
	# 	current_description = SWING_HOF_DESC
	# }

	on_accept = {

		scope:actor = {
			trigger_event = aeluran_character_interaction.003
		}

		# # Swing the scales in the direction of scope:actor.
		# scope:recipient = {
		# 	# Swing the scales down if this is the liege.
		# 	if = {
		# 		limit = { is_diarch_of_target = scope:actor }
		# 		send_interface_message = {
		# 			type = msg_mandate_results_bad_effect
		# 			title = swing_scales_interaction_by_liege.t
		# 			right_icon = scope:actor
		# 			scope:actor = {
		# 				# Viziers are give you more bang for your buck when swinging against 'em.
		# 				if = {
		# 					limit = { has_diarchy_active_parameter = lieges_swing_more_against_diarchs }
		# 					update_diarchy_swing_with_perspective_effect = {
		# 						SWING = major_sop_swing_liege_gain
		# 						LIEGE = scope:actor
		# 					}
		# 				}
		# 				else = {
		# 					update_diarchy_swing_with_perspective_effect = {
		# 						SWING = medium_sop_swing_liege_gain
		# 						LIEGE = scope:actor
		# 					}
		# 				}
		# 				diarch_swing_scales_guts_effect = yes
		# 			}
		# 		}
		# 	}
		# 	# And up if this is the diarch.
		# 	else = {
		# 		send_interface_message = {
		# 			type = msg_mandate_results_bad_effect
		# 			title = swing_scales_interaction_by_diarch.t
		# 			right_icon = scope:actor
		# 			update_diarchy_swing_with_perspective_effect = {
		# 				SWING = medium_sop_swing_diarch_gain
		# 				LIEGE = scope:recipient
		# 			}
		# 			scope:actor = { diarch_swing_scales_guts_effect = yes }
		# 		}
		# 	}
		# }
		# # Regardless of what happens, scope:recipient is a bit miffed.
		# scope:recipient = {
		# 	add_opinion = {
		# 		target = scope:actor
		# 		modifier = frustrated_opinion
		# 		opinion = -10
		# 	}
		# }
		# # Some diarchs might be swinging as a prelude to a coup attempt.
		# ai_diarch_check_to_see_if_should_launch_coup_effect = yes

		# # Debug & object explorer logging.
		# ## Diarch swung.
		# if = {
		# 	limit = {
		# 		exists = scope:recipient.diarch
		# 		scope:actor = scope:recipient.diarch
		# 	}
		# 	debug_log = debug_log.swing_scales.diarch_swung
		# 	scope:actor = {
		# 		diarch_interaction_set_or_update_global_variable_effect = { VARIABLE = di_track_swung_diarch }
		# 		diarch_interaction_add_to_global_list_effect = { VARIABLE_LIST = di_track_swung_diarch_list }
		# 	}
		# }
		# ## Else liege swung.
		# else = {
		# 	debug_log = debug_log.swing_scales.liege_swung
		# 	scope:actor = {
		# 		diarch_interaction_set_or_update_global_variable_effect = { VARIABLE = di_track_swung_liege }
		# 		diarch_interaction_add_to_global_list_effect = { VARIABLE_LIST = di_track_swung_liege_list }
		# 	}
		# }
	}

	auto_accept = yes

	# AI
	ai_targets = { ai_recipients = liege }
	ai_targets = { ai_recipients = diarch }
	ai_frequency = 24

	ai_potential = {
		OR = {
			# Either they're a liege.
			AND = {
				has_active_diarchy = yes
				# With some kind of valid cause to worry.
				OR = {
					# Lieges don't care unless your regency is entrenched _and_ it's looking to stay that way...
					has_diarchy_active_parameter = regency_cant_be_ended_above_this_point
					# ... unless they could get out of it.
					can_leave_diarchy_trigger = yes
				}
			}
			# Or they're the diarch.
			AND = {
				is_diarch = yes
				# Loyal diarchs don't engage in skullduggery.
				diarch_loyalty < diarch_loyalty_visibly_loyal_threshold
			}
		}
	}

	ai_will_do = {
		base  = 0
		# # We're generally ruthless here.
		# base = @ai_secondary_powers_base_value

		# # Additions.
		# ## Flag management.
		# ### Prestige.
		# modifier = {
		# 	add = 2
		# 	scope:swing_prestige = yes
		# }
		# ### Piety.
		# modifier = {
		# 	add = 3
		# 	scope:swing_piety = yes
		# }
		# ### Gold.
		# modifier = {
		# 	add = 1
		# 	scope:swing_gold = yes
		# }
		# ### Hook.
		# modifier = {
		# 	add = 5
		# 	scope:swing_hook = yes
		# }
		# ### HoF - combined Gold/Piety.
		# modifier = {
		# 	add = 4
		# 	scope:swing_hof = yes
		# }
		# # Factors.
		# ### x0 Don't go into prestige debt!
		# modifier = {
		# 	factor = 0
		# 	scope:swing_prestige = yes
		# 	prestige < 0
		# }
		# ## We take care of these in the ai_potential block, because otherwise the AI interacts very, very weirdly with them.
	}
}
